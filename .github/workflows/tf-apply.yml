
name: 'terraform-apply'

on:
  workflow_dispatch:      

permissions:
  contents: write
  id-token: write

jobs:
  terraform-apply:
    name: 'Terraform Apply'
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master'
    environment: prod
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    steps:
    - uses: actions/checkout@v4
    - uses: ./.github/actions/setup-aws-terraform
      with:
        use-format: true
        aws-role  : ${{ secrets.AWS_OIDC_ROLE_ARN }}
        aws-region: ${{ secrets.AWS_REGION }}

    - name: terraform apply
      run : terraform apply -auto-approve
